# 技能等级和经验设置指令使用说明

## 概述
新增的技能等级和经验设置指令允许管理员直接设置玩家技能的等级和经验值，支持创建新技能、修改现有技能、以及移除技能。

## 指令格式

### 通过指令系统调用
```lua
SkillCommands.main({
    ["ID"] = "玩家UIN",
    ["技能"] = "技能名称",
    ["等级"] = 目标等级,
    ["经验"] = 目标经验值,  -- 可选，默认为0
    ["类型"] = "设置等级"   -- 或者使用 "设置"
}, player)
```

### 直接调用函数
```lua
SkillCommands.setLevel({
    skillName = "技能名称",
    level = 目标等级,
    growth = 目标经验值  -- 可选，默认为0
}, player)
```

## 参数说明

- **技能名称** (skillName): 要设置的技能配置名称
- **等级** (level): 目标等级，必须在 0 到技能最大等级之间
- **经验** (growth): 目标经验值，必须为非负数（可选）
- **类型** (optype): 操作类型，使用 "设置等级" 或 "设置"

## 功能特性

### 1. 自动技能创建
- 如果玩家没有指定技能且目标等级 > 0，系统会自动创建该技能
- 如果玩家没有指定技能且目标等级 = 0，操作会失败

### 2. 技能移除
- 当目标等级设置为 0 时，系统会自动移除该技能
- 如果技能已装备，会先自动卸下再移除

### 3. 参数验证
- 自动验证技能配置是否存在
- 检查等级范围（0 到 maxLevel）
- 检查经验值是否为非负数

### 4. 装备状态处理
- 保持原有的装备槽位信息
- 移除技能时会自动卸下装备

## 使用示例

### 示例1：为玩家创建新技能并设置等级
```lua
-- 为玩家 "12345" 创建技能 "火球术" 并设置为 5级，100经验
SkillCommands.main({
    ["ID"] = "12345",
    ["技能"] = "火球术",
    ["等级"] = 5,
    ["经验"] = 100,
    ["类型"] = "设置等级"
}, player)
```

### 示例2：修改现有技能等级
```lua
-- 将玩家现有的 "冰霜箭" 技能设置为满级
SkillCommands.main({
    ["ID"] = "12345",
    ["技能"] = "冰霜箭",
    ["等级"] = 10,
    ["经验"] = 0,
    ["类型"] = "设置"
}, player)
```

### 示例3：移除玩家技能
```lua
-- 移除玩家的 "雷电术" 技能
SkillCommands.main({
    ["ID"] = "12345",
    ["技能"] = "雷电术",
    ["等级"] = 0,
    ["类型"] = "设置等级"
}, player)
```

### 示例4：只设置经验值
```lua
-- 设置技能经验而不改变等级（需要先获取当前等级）
SkillCommands.setLevel({
    skillName = "治疗术",
    level = 3,  -- 保持当前等级
    growth = 250  -- 设置新经验值
}, player)
```

## 响应事件

### 成功响应
事件名称: `SkillEventConfig.RESPONSE.SET_LEVEL`

响应数据格式:
```lua
{
    skillName = "技能名称",
    level = 当前等级,
    growth = 当前经验值,
    slot = 装备槽位,
    maxLevel = 最大等级,
    removed = 是否已移除,
    originalLevel = 原始等级,
    originalGrowth = 原始经验值
}
```

### 错误处理
- 技能配置不存在
- 等级参数无效
- 经验值为负数
- 玩家不存在
- 技能创建失败

## 日志输出

### 成功日志示例
```
信息: 技能等级和经验设置成功：3级→5级，经验 50→100，玩家: PlayerName 技能: 火球术
```

### 错误日志示例
```
错误: 设置技能等级失败: 技能配置不存在，玩家: PlayerName 技能: 不存在的技能
```

## 注意事项

1. **权限控制**: 此指令为管理员功能，需要适当的权限验证
2. **数据保存**: 操作会自动保存玩家技能配置到数据库
3. **客户端同步**: 修改后会自动向客户端发送更新通知
4. **装备处理**: 移除技能时会自动处理装备状态
5. **等级限制**: 不能设置超过技能配置中定义的最大等级

## 相关文件

- **指令处理**: `MSkillCommands.lua`
- **公共方法**: `SkillCommon.lua`  
- **事件配置**: `event_skill.lua`
- **事件管理**: `SkillEventManager.lua` 